<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <title>An√°lisis de Partidos</title>
  <style>
    body {
      font-family: system-ui, sans-serif;
      background:#f9fafb;
      padding:20px;
    }
    h2 { margin-top:30px }
    input, select, button {
      padding:6px;
      margin:4px 0;
      border-radius:6px;
      border:1px solid #d1d5db;
    }
    button {
      background:#2563eb;
      color:white;
      cursor:pointer;
    }
    .card {
      background:white;
      padding:12px;
      border-radius:10px;
      margin-top:10px;
      box-shadow:0 1px 4px rgba(0,0,0,.08);
    }
    .row {
      display:grid;
      grid-template-columns:1fr 1fr;
      gap:10px;
    }
    .small {
      font-size:13px;
      color:#6b7280;
    }
    /* =========================
   RESPONSIVE (CELULAR)
========================= */
@media (max-width: 768px) {
  body {
    padding: 12px;
  }

  h1 {
    font-size: 20px;
  }

  h2 {
    font-size: 16px;
  }

  .row {
    grid-template-columns: 1fr;
  }

  input, select, button {
    width: 100%;
    font-size: 14px;
  }

  button {
    padding: 10px;
  }

  .card {
    padding: 10px;
  }
}

/* =========================
   MODO OSCURO
========================= */
body.dark {
  background: #0f172a;
  color: #e5e7eb;
}

body.dark .card {
  background: #020617;
  box-shadow: none;
}

body.dark input,
body.dark select {
  background: #020617;
  color: #e5e7eb;
  border: 1px solid #334155;
}

body.dark button {
  background: #2563eb;
}

body.dark .small {
  color: #94a3b8;
}

  </style>
</head>

<body>

<h1>üìä An√°lisis de Partidos</h1>
<button id="toggleTheme" style="margin-bottom:15px">
  üåô Modo oscuro
</button>

<!-- =========================
     CREAR PARTIDO
========================= -->
<div class="card">
  <h2>‚ûï Nuevo Partido</h2>
  <input id="partidoNombre" placeholder="Ej: Real Madrid vs Barcelona" />
  <button onclick="crearPartido()">Crear / Cargar</button>
</div>

<!-- =========================
     ENFRENTAMIENTOS
========================= -->
<div class="card">
  <h2>‚öΩ Enfrentamientos previos</h2>

  <div class="row">
    <input id="golesA" placeholder="Goles Equipo A" type="number" />
    <input id="golesB" placeholder="Goles Equipo B" type="number" />

    <input id="tirosA" placeholder="Tiros Equipo A" type="number" />
    <input id="tirosB" placeholder="Tiros Equipo B" type="number" />

    <input id="tirosPuertaA" placeholder="Tiros a puerta A" type="number" />
    <input id="tirosPuertaB" placeholder="Tiros a puerta B" type="number" />

    <input id="cornersA" placeholder="Corners A" type="number" />
    <input id="cornersB" placeholder="Corners B" type="number" />

    <input id="tarjetasA" placeholder="Tarjetas A" type="number" />
    <input id="tarjetasB" placeholder="Tarjetas B" type="number" />
  </div>

  <button onclick="agregarEnfrentamiento()">Agregar enfrentamiento</button>
</div>

<!-- =========================
     JUGADORES A SEGUIR
========================= -->
<div class="card">
  <h2>üë§ Jugadores a seguir</h2>
  <input id="jugadorNombre" placeholder="Jugador" />
  <input id="jugadorEquipo" placeholder="Equipo" />
  <input id="jugadorMercado" placeholder="Mercado (Gol, tiros, etc)" />
  <input id="jugadorPromedio" placeholder="Promedio" type="number" step="0.01" />
  <button onclick="agregarJugador()">Agregar jugador</button>
</div>

<!-- =========================
     RESULTADOS
========================= -->
<div class="card">
  <h2>üìà Resultados</h2>
  <div id="resultados"></div>
</div>

<!-- =========================
     FIREBASE + JS
========================= -->
<script type="module">
/* =========================
   FIREBASE
========================= */
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import {
  getFirestore,
  doc,
  setDoc,
  getDoc
} from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyBtOk-otWrGU7ljda52yhVhSvQKaG3siRM",
  authDomain: "apuestas-analisis.firebaseapp.com",
  projectId: "apuestas-analisis",
  storageBucket: "apuestas-analisis.firebasestorage.app",
  messagingSenderId: "542021066839",
  appId: "1:542021066839:web:bb6a43f578a39d07c68312"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

/* =========================
   ESTADO
========================= */
let partidoId = null;
let data = {
  partido: "",
  enfrentamientos: [],
  jugadores: []
};

/* =========================
   CREAR / CARGAR
========================= */
window.crearPartido = async function () {
  const nombre = document.getElementById("partidoNombre").value.trim();
  if (!nombre) return alert("Ingresa un partido");

  partidoId = nombre.toLowerCase().replace(/\s+/g, "_");

  const ref = doc(db, "analisis_partidos", partidoId);
  const snap = await getDoc(ref);

  if (snap.exists()) {
    data = snap.data();
  } else {
    data.partido = nombre;
    await setDoc(ref, data);
  }

  render();
};

/* =========================
   AGREGAR ENFRENTAMIENTO
========================= */
window.agregarEnfrentamiento = async function () {
  if (!partidoId) return alert("Crea o carga un partido");

  data.enfrentamientos.push({
    golesA: +golesA.value,
    golesB: +golesB.value,
    tirosA: +tirosA.value,
    tirosB: +tirosB.value,
    tirosPuertaA: +tirosPuertaA.value,
    tirosPuertaB: +tirosPuertaB.value,
    cornersA: +cornersA.value,
    cornersB: +cornersB.value,
    tarjetasA: +tarjetasA.value,
    tarjetasB: +tarjetasB.value
  });

  await guardar();
};

/* =========================
   AGREGAR JUGADOR
========================= */
window.agregarJugador = async function () {
  if (!partidoId) return;

  data.jugadores.push({
    nombre: jugadorNombre.value,
    equipo: jugadorEquipo.value,
    mercado: jugadorMercado.value,
    promedio: jugadorPromedio.value
  });

  await guardar();
};

/* =========================
   GUARDAR
========================= */
async function guardar() {
  await setDoc(doc(db, "analisis_partidos", partidoId), data);
  render();
}

/* =========================
   CALCULOS
========================= */
function promedio(campoA, campoB) {
  if (!data.enfrentamientos.length) return 0;
  let total = 0;
  data.enfrentamientos.forEach(e => {
    total += e[campoA] + e[campoB];
  });
  return (total / data.enfrentamientos.length).toFixed(2);
}

function probabilidadMasDeGoles(min) {
  if (!data.enfrentamientos.length) return 0;
  const ok = data.enfrentamientos.filter(e =>
    e.golesA + e.golesB > min
  ).length;
  return Math.round((ok / data.enfrentamientos.length) * 100);
}

/* =========================
   RENDER
========================= */
function render() {
  const r = document.getElementById("resultados");

  r.innerHTML = `
    <b>${data.partido}</b><br><br>

    üìä Promedios:<br>
    ‚Ä¢ Goles: ${promedio("golesA","golesB")}<br>
    ‚Ä¢ Tiros: ${promedio("tirosA","tirosB")}<br>
    ‚Ä¢ Tiros a puerta: ${promedio("tirosPuertaA","tirosPuertaB")}<br>
    ‚Ä¢ Corners: ${promedio("cornersA","cornersB")}<br>
    ‚Ä¢ Tarjetas: ${promedio("tarjetasA","tarjetasB")}<br><br>

    üéØ Probabilidades:<br>
    ‚Ä¢ +0.5 goles: ${probabilidadMasDeGoles(0.5)}%<br>
    ‚Ä¢ +1.5 goles: ${probabilidadMasDeGoles(1.5)}%<br>
    ‚Ä¢ +2.5 goles: ${probabilidadMasDeGoles(2.5)}%<br><br>

    üë§ Jugadores a seguir:<br>
    ${data.jugadores.map(j =>
      `‚Ä¢ ${j.nombre} (${j.equipo}) ‚Üí ${j.mercado} (${j.promedio})`
    ).join("<br>")}
  `;
}
  /* =========================
   MODO OSCURO
========================= */
const btnTheme = document.getElementById("toggleTheme");

if (localStorage.getItem("theme") === "dark") {
  document.body.classList.add("dark");
  btnTheme.textContent = "‚òÄÔ∏è Modo claro";
}

btnTheme.addEventListener("click", () => {
  document.body.classList.toggle("dark");
  const dark = document.body.classList.contains("dark");
  localStorage.setItem("theme", dark ? "dark" : "light");
  btnTheme.textContent = dark ? "‚òÄÔ∏è Modo claro" : "üåô Modo oscuro";
});

</script>

</body>
</html>
