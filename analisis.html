<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <title>AnÃ¡lisis de Partidos</title>
  <style>
    body {
      font-family: system-ui, sans-serif;
      background:#f9fafb;
      padding:20px;
    }
    h2 { margin-top:30px }
    input, select, button {
      padding:6px;
      margin:4px 0;
      border-radius:6px;
      border:1px solid #d1d5db;
    }
    button {
      background:#2563eb;
      color:white;
      cursor:pointer;
    }
    .card {
      background:white;
      padding:12px;
      border-radius:10px;
      margin-top:10px;
      box-shadow:0 1px 4px rgba(0,0,0,.08);
    }
    .row {
      display:grid;
      grid-template-columns:1fr 1fr;
      gap:10px;
    }
    .small {
      font-size:13px;
      color:#6b7280;
    }
  </style>
</head>

<body>

<h1>ðŸ“Š AnÃ¡lisis de Partidos</h1>

<!-- =========================
     CREAR PARTIDO
========================= -->
<div class="card">
  <h2>âž• Nuevo Partido</h2>
  <input id="partidoNombre" placeholder="Ej: Real Madrid vs Barcelona" />
  <button onclick="crearPartido()">Crear / Cargar</button>
</div>

<!-- =========================
     ENFRENTAMIENTOS
========================= -->
<div class="card">
  <h2>âš½ Enfrentamientos previos</h2>

  <div class="row">
    <input id="golesA" placeholder="Goles Equipo A" type="number" />
    <input id="golesB" placeholder="Goles Equipo B" type="number" />

    <input id="tirosA" placeholder="Tiros Equipo A" type="number" />
    <input id="tirosB" placeholder="Tiros Equipo B" type="number" />

    <input id="tirosPuertaA" placeholder="Tiros a puerta A" type="number" />
    <input id="tirosPuertaB" placeholder="Tiros a puerta B" type="number" />

    <input id="cornersA" placeholder="Corners A" type="number" />
    <input id="cornersB" placeholder="Corners B" type="number" />

    <input id="tarjetasA" placeholder="Tarjetas A" type="number" />
    <input id="tarjetasB" placeholder="Tarjetas B" type="number" />
  </div>

  <button onclick="agregarEnfrentamiento()">Agregar enfrentamiento</button>
</div>

<!-- =========================
     JUGADORES A SEGUIR
========================= -->
<div class="card">
  <h2>ðŸ‘¤ Jugadores a seguir</h2>
  <input id="jugadorNombre" placeholder="Jugador" />
  <input id="jugadorEquipo" placeholder="Equipo" />
  <input id="jugadorMercado" placeholder="Mercado (Gol, tiros, etc)" />
  <input id="jugadorPromedio" placeholder="Promedio" type="number" step="0.01" />
  <button onclick="agregarJugador()">Agregar jugador</button>
</div>

<!-- =========================
     RESULTADOS
========================= -->
<div class="card">
  <h2>ðŸ“ˆ Resultados</h2>
  <div id="resultados"></div>
</div>

<!-- =========================
     FIREBASE + JS
========================= -->
<script type="module">
/* =========================
   FIREBASE
========================= */
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import {
  getFirestore,
  doc,
  setDoc,
  getDoc
} from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyBtOk-otWrGU7ljda52yhVhSvQKaG3siRM",
  authDomain: "apuestas-analisis.firebaseapp.com",
  projectId: "apuestas-analisis",
  storageBucket: "apuestas-analisis.firebasestorage.app",
  messagingSenderId: "542021066839",
  appId: "1:542021066839:web:bb6a43f578a39d07c68312"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

/* =========================
   ESTADO
========================= */
let partidoId = null;
let data = {
  partido: "",
  enfrentamientos: [],
  jugadores: []
};

/* =========================
   CREAR / CARGAR
========================= */
window.crearPartido = async function () {
  const nombre = document.getElementById("partidoNombre").value.trim();
  if (!nombre) return alert("Ingresa un partido");

  partidoId = nombre.toLowerCase().replace(/\s+/g, "_");

  const ref = doc(db, "analisis_partidos", partidoId);
  const snap = await getDoc(ref);

  if (snap.exists()) {
    data = snap.data();
  } else {
    data.partido = nombre;
    await setDoc(ref, data);
  }

  render();
};

/* =========================
   AGREGAR ENFRENTAMIENTO
========================= */
window.agregarEnfrentamiento = async function () {
  if (!partidoId) return alert("Crea o carga un partido");

  data.enfrentamientos.push({
    golesA: +golesA.value,
    golesB: +golesB.value,
    tirosA: +tirosA.value,
    tirosB: +tirosB.value,
    tirosPuertaA: +tirosPuertaA.value,
    tirosPuertaB: +tirosPuertaB.value,
    cornersA: +cornersA.value,
    cornersB: +cornersB.value,
    tarjetasA: +tarjetasA.value,
    tarjetasB: +tarjetasB.value
  });

  await guardar();
};

/* =========================
   AGREGAR JUGADOR
========================= */
window.agregarJugador = async function () {
  if (!partidoId) return;

  data.jugadores.push({
    nombre: jugadorNombre.value,
    equipo: jugadorEquipo.value,
    mercado: jugadorMercado.value,
    promedio: jugadorPromedio.value
  });

  await guardar();
};

/* =========================
   GUARDAR
========================= */
async function guardar() {
  await setDoc(doc(db, "analisis_partidos", partidoId), data);
  render();
}

/* =========================
   CALCULOS
========================= */
function promedio(campoA, campoB) {
  if (!data.enfrentamientos.length) return 0;
  let total = 0;
  data.enfrentamientos.forEach(e => {
    total += e[campoA] + e[campoB];
  });
  return (total / data.enfrentamientos.length).toFixed(2);
}

function probabilidadMasDeGoles(min) {
  if (!data.enfrentamientos.length) return 0;
  const ok = data.enfrentamientos.filter(e =>
    e.golesA + e.golesB > min
  ).length;
  return Math.round((ok / data.enfrentamientos.length) * 100);
}

/* =========================
   RENDER
========================= */
function render() {
  const r = document.getElementById("resultados");

  r.innerHTML = `
    <b>${data.partido}</b><br><br>

    ðŸ“Š Promedios:<br>
    â€¢ Goles: ${promedio("golesA","golesB")}<br>
    â€¢ Tiros: ${promedio("tirosA","tirosB")}<br>
    â€¢ Tiros a puerta: ${promedio("tirosPuertaA","tirosPuertaB")}<br>
    â€¢ Corners: ${promedio("cornersA","cornersB")}<br>
    â€¢ Tarjetas: ${promedio("tarjetasA","tarjetasB")}<br><br>

    ðŸŽ¯ Probabilidades:<br>
    â€¢ +0.5 goles: ${probabilidadMasDeGoles(0.5)}%<br>
    â€¢ +1.5 goles: ${probabilidadMasDeGoles(1.5)}%<br>
    â€¢ +2.5 goles: ${probabilidadMasDeGoles(2.5)}%<br><br>

    ðŸ‘¤ Jugadores a seguir:<br>
    ${data.jugadores.map(j =>
      `â€¢ ${j.nombre} (${j.equipo}) â†’ ${j.mercado} (${j.promedio})`
    ).join("<br>")}
  `;
}
</script>

</body>
</html>
