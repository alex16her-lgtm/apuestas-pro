<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Análisis de Partidos</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

<style>
:root{
  --bg:#0f172a;
  --card:#020617;
  --text:#e5e7eb;
  --muted:#94a3b8;
  --border:#1e293b;
  --accent:#22c55e;
}

*{box-sizing:border-box}
body{
  margin:0;
  background:var(--bg);
  color:var(--text);
  font-family:system-ui;
}
.container{max-width:1200px;margin:auto;padding:16px}
.card{
  background:var(--card);
  border:1px solid var(--border);
  border-radius:12px;
  padding:16px;
  margin-bottom:16px;
}
input,button{
  background:#020617;
  color:var(--text);
  border:1px solid var(--border);
  border-radius:8px;
  padding:8px;
  width:100%;
}
button{
  background:var(--accent);
  color:#022c22;
  font-weight:700;
  cursor:pointer;
}
.grid{
  display:grid;
  gap:8px;
  grid-template-columns:repeat(auto-fit,minmax(120px,1fr));
}
.table{
  width:100%;
  border-collapse:collapse;
  font-size:12px;
}
.table th,.table td{
  border:1px solid var(--border);
  padding:6px;
  text-align:center;
}
.table th{color:var(--muted)}
.small{font-size:11px;color:var(--muted)}
@media(max-width:600px){
  .table{font-size:10px}
}
</style>
</head>

<body>
<div class="container">

<!-- PARTIDO -->
<div class="card">
<h2>Partido (A - B)</h2>
<div class="grid">
<input id="teamA" placeholder="Equipo A">
<input id="teamB" placeholder="Equipo B">
</div>
</div>

<!-- ENCUENTRO -->
<div class="card">
<h3>Agregar Encuentro</h3>
<div class="grid">
<input id="competencia" placeholder="Competencia">

<input id="ttA" placeholder="Tiros Totales A">
<input id="ttB" placeholder="Tiros Totales B">

<input id="tapA" placeholder="A Puerta A">
<input id="tapB" placeholder="A Puerta B">

<input id="corA" placeholder="Corners A">
<input id="corB" placeholder="Corners B">

<input id="tarA" placeholder="Tarjetas A">
<input id="tarB" placeholder="Tarjetas B">

<input id="golA" placeholder="Goles A">
<input id="golB" placeholder="Goles B">
</div>
<br>
<button onclick="addMatch()">AÑADIR ENCUENTRO</button>
</div>

<!-- HISTORIAL -->
<div class="card">
<h3>Historial</h3>
<div id="historial"></div>
<table class="table" id="tabla">
<thead>
<tr>
<th>Partido</th>
<th>Competencia</th>
<th>TT (A|B)</th>
<th>AP (A|B)</th>
<th>COR (A|B)</th>
<th>TAR (A|B)</th>
<th>GOL (A|B)</th>
</tr>
</thead>
<tbody></tbody>
<tfoot>
<tr><th colspan="2">TOTAL</th>
<th id="t1"></th><th id="t2"></th><th id="t3"></th><th id="t4"></th><th id="t5"></th></tr>
<tr><th colspan="2">PROMEDIO</th>
<th id="p1"></th><th id="p2"></th><th id="p3"></th><th id="p4"></th><th id="p5"></th></tr>
<tr><th colspan="2">PROBABILIDAD</th>
<th id="pr1"></th><th id="pr2"></th><th id="pr3"></th><th id="pr4"></th><th id="pr5"></th></tr>
</tfoot>
</table>
</div>

</div>

<script>
const firebaseConfig = {
  apiKey: "AIzaSyBtOk-otWrGU7ljda52yhVhSvQKaG3siRM",
  authDomain: "apuestas-analisis.firebaseapp.com",
  projectId: "apuestas-analisis",
  storageBucket: "apuestas-analisis.firebasestorage.app",
  messagingSenderId: "542021066839",
  appId: "1:542021066839:web:bb6a43f578a39d07c68312"
};

firebase.initializeApp(firebaseConfig);
const db = firebase.firestore();
const ref = db.collection("analisis");

// agregar encuentro
async function addMatch() {
  const equipoA = teamA.value.trim();
  const equipoB = teamB.value.trim();

  if (!equipoA || !equipoB) {
    alert("Faltan equipos");
    return;
  }

  const encuentro = {
    competencia: competencia.value,
    stats: {
      tt:{A:+ttA.value,B:+ttB.value},
      tap:{A:+tapA.value,B:+tapB.value},
      cor:{A:+corA.value,B:+corB.value},
      tar:{A:+tarA.value,B:+tarB.value},
      gol:{A:+golA.value,B:+golB.value}
    }
  };

  // buscar si ya existe ese análisis
  const q = await ref
    .where("equipoA","==",equipoA)
    .where("equipoB","==",equipoB)
    .get();

  if (q.empty) {
    await ref.add({
      equipoA,
      equipoB,
      encuentros:[encuentro],
      creado: firebase.firestore.FieldValue.serverTimestamp()
    });
  } else {
    const doc = q.docs[0];
    await ref.doc(doc.id).update({
      encuentros: firebase.firestore.FieldValue.arrayUnion(encuentro)
    });
  }
}
ref.onSnapshot(snapshot => {
  const h = document.getElementById("historial");
  h.innerHTML = "";

  snapshot.forEach(doc => {
    const m = doc.data();
    const encuentros = m.encuentros || [];

    let tot = {
      tt: 0, tap: 0, cor: 0, tar: 0, gol: 0
    };

    let filas = "";

    encuentros.forEach(e => {
      const s = e.stats;

      tot.tt  += s.tt.A  + s.tt.B;
      tot.tap += s.tap.A + s.tap.B;
      tot.cor += s.cor.A + s.cor.B;
      tot.tar += s.tar.A + s.tar.B;
      tot.gol += s.gol.A + s.gol.B;

      filas += `
        <tr>
          <td>${m.equipoA} vs ${m.equipoB}</td>
          <td>${e.competencia}</td>
          <td>${s.tt.A}|${s.tt.B}</td>
          <td>${s.tap.A}|${s.tap.B}</td>
          <td>${s.cor.A}|${s.cor.B}</td>
          <td>${s.tar.A}|${s.tar.B}</td>
          <td>${s.gol.A}|${s.gol.B}</td>
        </tr>
      `;
    });

    const n = encuentros.length || 1;

    h.innerHTML += `
    <details class="card">
      <summary>⚽ ${m.equipoA} vs ${m.equipoB} (${encuentros.length} encuentros)</summary>

      <table class="table">
        <thead>
          <tr>
            <th>Partido</th>
            <th>Competencia</th>
            <th>TT (A|B)</th>
            <th>AP (A|B)</th>
            <th>COR (A|B)</th>
            <th>TAR (A|B)</th>
            <th>GOL (A|B)</th>
          </tr>
        </thead>

        <tbody>
          ${filas}
        </tbody>

        <tfoot>
          <tr>
            <th colspan="2">TOTAL</th>
            <th>${tot.tt}</th>
            <th>${tot.tap}</th>
            <th>${tot.cor}</th>
            <th>${tot.tar}</th>
            <th>${tot.gol}</th>
          </tr>

          <tr>
            <th colspan="2">PROMEDIO</th>
            <th>${(tot.tt/n).toFixed(1)}</th>
            <th>${(tot.tap/n).toFixed(1)}</th>
            <th>${(tot.cor/n).toFixed(1)}</th>
            <th>${(tot.tar/n).toFixed(1)}</th>
            <th>${(tot.gol/n).toFixed(1)}</th>
          </tr>

          <tr>
  <td colspan="2"><b>PROBABILIDAD</b></td>
  <td>${overUnder(tot.tt,20)}</td>
  <td>${overUnder(tot.tap,8)}</td>
  <td>${overUnder(tot.cor,9)}</td>
  <td>${overUnder(tot.tar,4)}</td>
  <td>${overUnder(tot.gol,2.5)}</td>
</tr>

        </tfoot>
      </table>
    </details>`;
  });
});
</script>


</body>
</html>
